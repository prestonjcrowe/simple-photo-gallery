<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Gallery</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        height: 100%;
      }

      #app {
        width: 100vw;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        background-color: #333;
      }

      .photo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(600px, 1fr));
        gap: 5px;
        padding: 5px;
      }

      .photo-item {
        width: 100%;
        overflow: hidden;
        cursor: pointer;
        background-color: #333;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .photo-item img {
        width: 100%;
        height: auto;
        object-fit: contain;
        display: block;
        transition: transform 0.2s ease-in-out;
      }

      .photo-item img:hover {
        transform: scale(1.05);
      }

      /* Lightbox Styles */
      .lightbox-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .lightbox-content {
        position: relative;
        max-width: 95vw;
        max-height: 95vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .lightbox-content img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        display: block;
      }

      .lightbox-button {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background-color: rgba(255, 255, 255, 0.3);
        color: white;
        border: none;
        padding: 15px 10px;
        cursor: pointer;
        font-size: 24px;
        user-select: none;
        border-radius: 5px;
        transition: background-color 0.2s ease-in-out;
        z-index: 1001;
      }

      .lightbox-button:hover {
        background-color: rgba(255, 255, 255, 0.5);
      }

      .lightbox-button.prev {
        left: 10px;
      }

      .lightbox-button.next {
        right: 10px;
      }

      .lightbox-close {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: rgba(255, 255, 255, 0.3);
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        font-size: 24px;
        border-radius: 5px;
        transition: background-color 0.2s ease-in-out;
        z-index: 1001;
      }

      .lightbox-close:hover {
        background-color: rgba(255, 255, 255, 0.5);
      }

      @media (max-width: 768px) {
        .photo-grid {
          /* grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); */
          gap: 3px;
          padding: 3px;
        }

        .lightbox-button {
          padding: 10px 5px;
          font-size: 18px;
        }

        .lightbox-close {
          padding: 3px 8px;
          font-size: 20px;
        }
      }

      @media (max-width: 480px) {
        .photo-grid {
          /* grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); */
          gap: 2px;
          padding: 2px;
        }

        .lightbox-button {
          padding: 8px 3px;
          font-size: 16px;
        }

        .lightbox-close {
          padding: 2px 6px;
          font-size: 18px;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="photo-grid">
        <div
          v-for="(photo, index) in photos"
          :key="photo.src"
          class="photo-item"
          @click="openLightbox(index)"
        >
          <img :src="photo.src" :alt="photo.title" loading="lazy" />
        </div>
      </div>

      <div
        class="lightbox-overlay"
        v-if="lightboxOpen"
        @click.self="closeLightbox"
      >
        <div class="lightbox-content">
          <img :src="currentPhoto.src" :alt="currentPhoto.title" />
          <button class="lightbox-button prev" @click="prevPhoto">
            &#10094;
          </button>
          <button class="lightbox-button next" @click="nextPhoto">
            &#10095;
          </button>
          <button class="lightbox-close" @click="closeLightbox">
            &#x2715;
          </button>
        </div>
      </div>
    </div>

    <script>
      const { createApp, ref, onMounted, computed } = Vue;

      const INDEX_URL =
        "https://pcrowe-photography.s3.amazonaws.com/index.json";

      createApp({
        setup() {
          const photos = ref([]);
          const lightboxOpen = ref(false);
          const currentPhotoIndex = ref(0);

          const fetchPhotos = () => {
            fetch(INDEX_URL)
              .then((res) => res.json())
              .then((json) => {
                photos.value = json
                  .map((p) => ({
                    src: p.url,
                    width: p.w,
                    height: p.h,
                    title: p.caption,
                    date: p.date,
                  }))
                  .sort((a, b) => new Date(b.date) - new Date(a.date));
              })
              .catch((error) => {
                console.error("Error fetching photos:", error);
              });
          };

          const openLightbox = (index) => {
            currentPhotoIndex.value = index;
            lightboxOpen.value = true;
            document.body.style.overflow = "hidden"; // Prevent scrolling when lightbox is open
          };

          const closeLightbox = () => {
            lightboxOpen.value = false;
            document.body.style.overflow = ""; // Restore scrolling
          };

          const currentPhoto = computed(() => {
            return photos.value[currentPhotoIndex.value];
          });

          const nextPhoto = () => {
            currentPhotoIndex.value =
              (currentPhotoIndex.value + 1) % photos.value.length;
          };

          const prevPhoto = () => {
            currentPhotoIndex.value =
              (currentPhotoIndex.value - 1 + photos.value.length) %
              photos.value.length;
          };

          // Keyboard navigation for lightbox
          const handleKeyDown = (event) => {
            if (!lightboxOpen.value) return;

            if (event.key === "ArrowRight") {
              nextPhoto();
            } else if (event.key === "ArrowLeft") {
              prevPhoto();
            } else if (event.key === "Escape") {
              closeLightbox();
            }
          };

          onMounted(() => {
            fetchPhotos();
            window.addEventListener("keydown", handleKeyDown);
          });

          // Clean up event listener when component is unmounted (though for a single page app, this is less critical)
          Vue.onUnmounted(() => {
            window.removeEventListener("keydown", handleKeyDown);
          });

          return {
            photos,
            lightboxOpen,
            currentPhotoIndex,
            openLightbox,
            closeLightbox,
            currentPhoto,
            nextPhoto,
            prevPhoto,
          };
        },
      }).mount("#app");
    </script>
  </body>
</html>